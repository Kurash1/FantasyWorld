new class survey = {
	list = surveys
	id = `{this:id}`
	args = {
		name = string
		x = int
		y = int
		province_group = province_group
	}
	on_create = {
		new custom_button `start_survey_{this:id}` = {
			tooltip = "Begin Surveying {this:name}"
			potential =* {
				NOT = {
					has_country_flag = surveyed_*this:id*
				}
				surveys:*this:id*:province_group = {
					NOT = { has_discovered = ROOT }
				}
			}
			trigger =* {
				has_global_modifier_value = {
					which = may_explore
					value = 1
				}
				NOT = {
					has_country_modifier = currently_surveying
					has_country_modifier = currently_passive_surveying
				}
				surveys:*this:id*:province_group = {
					any_neighbor_province = {
						has_discovered = ROOT
					}
				}
			}
			effect =* {
				add_country_modifier = {
					name = currently_surveying
					duration = -1
				}
				set_country_flag = surveying_*this:id*
				hidden_effect = {
					&survey_progress := 0
					&survey_progress_percentage := 0
					
					surveys:*this:id*:province_group = {
						ROOT = {
							export_to_variable = {
								which = survey_temp
								value = trigger_value:province_size
								who = PREV
							}
							
							if [has_discovered = PREV] {
								&survey_temp := 0
							}
							
							&survey_length += survey_temp
						}
					}
				}
			}
		}
		
		new localisation `survey_{this:id}` = `{this:name}`
		
		customizable_localizations:GetActiveSurvey:texts += {
			{
				text = this:name
				trigger =* {
					has_country_flag = `surveying_*this:id*`
				}
			}
		}
		
		scouting_company_menu_node += {
			guiButtonType = {
				name = `start_survey_{this:id}`
				position = { x = (this:x) y = (this:y-9-128+11) }
				quadTextureSprite = "GFX_survey_icon"
				scripted = yes
			}
		}
	}
}
new class special_survey = {
	list = special_surveys
	id = `{this:id}`
	args = {
		name = string
		length = int
		on_complete = named_effect
	}
	on_create = {
		customizable_localizations:GetActiveSurvey:texts += {
			{
				text = this:name
				trigger =* {
					has_country_flag = `surveying_*this:id*`
				}
			}
		}
	}
}
new localisation survey_completion_tt = "The following happens upon the completion of the Survey:"
new effect start_special_survey = {
	args = {
		survey = special_survey
		show_tooltip = bool
	}
	transpile = {
		add_country_modifier = {
			name = currently_passive_surveying
			duration = -1
		}
		hidden_effect = {
			set_country_flag = `surveying_{args:survey:id}`
			&survey_progress := 0
			&survey_progress_percentage := 0
			&survey_length := args:survey:length
		}
		
		when [args:show_tooltip == yes] {
			custom_tooltip = survey_completion_tt
			tooltip = {
				args:survey:on_complete
			}
		}
	}
}
new event_modifier currently_surveying = {
	name = "Currently Surveying"
	modifier = {
		scouts_survival_efficiency = -0.5
		scouts_maintenance_efficiency = -0.5
	}
}
new event_modifier currently_passive_surveying = {
	name = "Currently doing a Passive Survey"
	modifier = {
		scouts_survival_efficiency = -0.5
		scouts_maintenance_efficiency = -0.5
	}
}